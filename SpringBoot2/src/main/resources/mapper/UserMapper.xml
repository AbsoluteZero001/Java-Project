<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springboot.springboot2.mapper.UserMapper">

    <!-- 全部列 -->
    <sql id="fullCols">
        userid AS userId,
        username,
        account,
        idcard,
        gender,
        age,
        user_type AS userType,
        user_status AS userStatus,
        user_roomid AS userRoomId
    </sql>

    <!-- 简单列 -->
    <sql id="simpleCols">
        userid AS userId,
        username,
        gender,
        age,
        user_status AS userStatus,
        user_roomid AS userRoomId
    </sql>

    <!-- 基础结果映射 -->
    <resultMap id="baseColumns" type="com.springboot.springboot2.pojo.User">
        <id column="userId" property="userId"/>
        <result column="username" property="username"/>
        <result column="account" property="account"/>
        <result column="idcard" property="idcard"/>
        <result column="gender" property="gender"/>
        <result column="age" property="age"/>
        <result column="userType" property="userType"/>
        <result column="userStatus" property="userStatus"/>
        <result column="userRoomId" property="userRoomId"/>
    </resultMap>

    <!-- 业主带房间关联 -->
    <resultMap id="ownRoom" type="com.springboot.springboot2.pojo.User" extends="baseColumns">
        <association property="room" column="userRoomId" javaType="com.springboot.springboot2.pojo.Room"
                     select="com.springboot.springboot2.mapper.RoomMapper.roomById"/>
    </resultMap>

    <!-- 分页查询业主列表 -->
    <select id="owners" resultMap="ownRoom">
        SELECT <include refid="simpleCols"/>
        FROM user
        WHERE user_type = 3
    </select>

    <update id="changeUserStatus">
        UPDATE user
        SET user_status = #{userStatus}
        WHERE userid = #{userId}
    </update>

</mapper>
